_**CONFIDENTIAL**_ 

# UFO³ Galaxy - Android 客户端集成测试方案

**文档版本:** 1.0  
**测试阶段:** 端到端集成测试 (E2E)  
**测试环境:** Android 客户端 + Galaxy Gateway (本地) + Windows 客户端  
**日期:** 2026-01-24

---

## 1. 测试目标

本次测试旨在全面验证 UFO³ Galaxy Android 客户端的核心功能、稳定性、性能及与整个系统的协同工作的能力。确保 Android 客户端在功能上与 Windows 客户端对等，并达到生产环境部署标准。

**核心验证点:**
- **端到端通信:** 验证从 Android 客户端到 Galaxy Gateway，再到其他节点（如 Windows 客户端）的完整通信链路。
- **功能完整性:** 确保所有已开发功能（通信、WebRTC、浮窗 UI、无障碍服务）按预期工作。
- **系统协调:** 测试 Android 和 Windows 客户端在多设备环境下的协同操作能力。
- **稳定性和可靠性:** 验证应用在长时间运行、网络波动和异常操作下的稳定性。

---

## 2. 测试范围

| 模块 | 测试子项 |
| :--- | :--- |
| **基础通信** | 设备注册、心跳机制、WebSocket 消息收发 (AIP v2.0) |
| **浮窗 UI** | 界面显示、拖动、展开/收起、文本输入、语音输入 |
| **WebRTC** | 屏幕共享发起、信令交换、视频流传输、屏幕共享停止 |
| **系统协调** | 多客户端（Android + Windows）同时在线、任务广播、状态同步 |
| **异常处理** | 网络断开重连、服务崩溃恢复、权限缺失处理 |

---

## 3. 测试用例 (Test Cases)

### 3.1 基础通信测试 (P0 - 高优先级)

| 用例 ID | 测试描述 | 预置条件 | 测试步骤 | 预期结果 | 测试状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **TC-COMM-01** | **设备注册** | Galaxy Gateway 正在运行。 | 1. 在 Android 设备上首次启动应用。<br>2. 监控 Gateway 日志。 | 1. Android 设备成功连接到 Gateway。<br>2. Gateway 日志显示新设备注册，包含正确的设备 ID 和设备信息。 | `待测试` |
| **TC-COMM-02** | **心跳机制** | Android 客户端已注册并连接。 | 1. 保持客户端运行超过 1 分钟。<br>2. 监控 Gateway 日志和客户端日志。 | 1. 客户端每隔 30 秒发送一次心跳消息。<br>2. Gateway 收到心跳并确认设备在线。 | `待测试` |
| **TC-COMM-03** | **文本消息发送** | Android 客户端已连接。 | 1. 在浮窗 UI 中输入文本 "Hello, Galaxy"。<br>2. 点击发送按钮。<br>3. 监控 Gateway 日志。 | 1. Gateway 收到类型为 `task` 的 AIP 消息。<br>2. 消息内容为 `{"text": "Hello, Galaxy"}`。 | `待测试` |

### 3.2 浮窗 UI 测试 (P0 - 高优先级)

| 用例 ID | 测试描述 | 预置条件 | 测试步骤 | 预期结果 | 测试状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **TC-UI-01** | **浮窗显示与拖动** | 已授予 `SYSTEM_ALERT_WINDOW` 权限。 | 1. 启动 `FloatingWindowService`。<br>2. 拖动展开的浮窗。<br>3. 点击最小化按钮。<br>4. 拖动最小化的胶囊浮窗。 | 1. 浮窗正常显示在屏幕顶层。<br>2. 浮窗可以平滑地在屏幕上拖动。<br>3. 浮窗可以正确地在展开和最小化状态间切换。 | `待测试` |
| **TC-UI-02** | **语音输入** | 已授予 `RECORD_AUDIO` 权限。 | 1. 点击语音输入按钮。<br>2. 对麦克风说 "测试语音输入"。<br>3. 监控客户端日志和 Gateway 日志。 | 1. 语音按钮状态变为“正在收听”。<br>2. 识别的文本 "测试语音输入" 自动填入输入框并发送。<br>3. Gateway 收到包含该文本的任务消息。 | `待测试` |

### 3.3 WebRTC 屏幕共享测试 (P1 - 中优先级)

| 用例 ID | 测试描述 | 预置条件 | 测试步骤 | 预期结果 | 测试状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **TC-WRTC-01** | **发起屏幕共享** | Android 客户端已连接。 | 1. 通过特定指令（或UI按钮）触发屏幕共享。<br>2. 接受 MediaProjection 权限请求。<br>3. 监控 Gateway 日志。 | 1. 客户端发送 `webrtc_offer` 信令消息到 Gateway。<br>2. Gateway 收到 Offer。 | `待测试` |
| **TC-WRTC-02** | **接收端视频流** | Node_34_Scrcpy 或一个 Web 客户端作为接收端。 | 1. 接收端收到 Offer，创建 Answer 并发送。<br>2. Android 客户端收到 Answer。<br>3. ICE Candidate 交换完成。 | 1. 接收端成功建立 PeerConnection。<br>2. 接收端能实时看到 Android 设备的屏幕画面，延迟较低。 | `待测试` |

### 3.4 系统协调测试 (P1 - 中优先级)

| 用例 ID | 测试描述 | 预置条件 | 测试步骤 | 预期结果 | 测试状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **TC-SYS-01** | **多客户端同时在线** | Windows 客户端和 Android 客户端均已连接。 | 1. 在 Gateway 中查看设备列表。<br>2. 从任一客户端发送广播消息。 | 1. 设备列表中同时包含 Windows 和 Android 设备。<br>2. 两个客户端都能收到广播消息。 | `待测试` |

### 3.5 异常处理测试 (P2 - 低优先级)

| 用例 ID | 测试描述 | 预置条件 | 测试步骤 | 预期结果 | 测试状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **TC-EX-01** | **网络断开重连** | Android 客户端已连接。 | 1. 在设备上关闭 Wi-Fi 和移动数据。<br>2. 观察客户端日志。<br>3. 重新开启网络。 | 1. 客户端检测到网络断开，进入重连状态。<br>2. WebSocketClient 尝试以指数退避策略重连。<br>3. 网络恢复后，客户端自动重新连接并完成设备注册。 | `待测试` |

---

## 4. 测试环境与工具

- **硬件:**
  - Android 测试设备 (Android 10+)
  - 开发 PC (运行 Galaxy Gateway 和 Windows 客户端)
- **软件:**
  - Android Studio (用于日志监控和调试)
  - Visual Studio Code (用于查看 Gateway 日志)
  - `adb` (Android Debug Bridge)
- **网络:**
  - 本地 Wi-Fi 网络，确保 PC 和 Android 设备在同一网段。

---

## 5. 测试执行与报告

- 测试将按照用例优先级 (P0 > P1 > P2) 顺序执行。
- 每个测试用例执行后，将更新其 **测试状态** (`通过`, `失败`, `跳过`)。
- 发现的任何问题都将记录在 GitHub Issues 中，并进行跟踪。
- 测试完成后，将生成一份详细的测试报告，总结测试结果、发现的问题和改进建议。
